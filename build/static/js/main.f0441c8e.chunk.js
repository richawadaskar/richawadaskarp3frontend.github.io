(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{19:function(e,t,s){e.exports=s(45)},24:function(e,t,s){},25:function(e,t,s){e.exports=s.p+"static/media/logo.25bf045c.svg"},26:function(e,t,s){},45:function(e,t,s){"use strict";s.r(t);var n=s(0),o=s.n(n),a=s(17),r=s.n(a),l=(s(24),s(18)),i=s(3),c=s(4),u=s(6),m=s(5),g=s(2),d=s(7),v=(s(25),s(26),s(27),"http://chat.cs291.com/"),h="",p=function(e){function t(e){var s;return Object(i.a)(this,t),(s=Object(u.a)(this,Object(m.a)(t).call(this,e))).loginSuccessful=function(e){s.setState({showLogin:!1,showChatRoom:!0,showFailedLogin:!1});var t=new EventSource(v+"/stream/"+e);t.onmessage=function(e){console.log("event received."),console.log(e.data)},t.addEventListener("Users",(function(e){return s.user_list(e)})),t.addEventListener("Join",(function(e){return s.user_join(e)})),t.addEventListener("Part",(function(e){return s.user_part(e)})),t.addEventListener("Message",(function(e){return s.new_message(e)})),t.addEventListener("Messages",(function(e){return s.message_history(e)})),t.addEventListener("Disconnect",(function(e){return s.server_disconnect(e)})),t.addEventListener("ServerStatus",(function(e){return s.server_status(e)}))},s.loginFailed=function(){s.setState({showFailedLogin:!0})},s.state={showLogin:!0,showChatRoom:!1,showFailedLogin:!1,messages:[],users:[]},s.user_list=s.user_list.bind(Object(g.a)(s)),s.user_join=s.user_join.bind(Object(g.a)(s)),s.user_part=s.user_part.bind(Object(g.a)(s)),s.message_history=s.message_history.bind(Object(g.a)(s)),s.new_message=s.new_message.bind(Object(g.a)(s)),s.server_disconnect=s.server_disconnect.bind(Object(g.a)(s)),s.server_status=s.server_status.bind(Object(g.a)(s)),s}return Object(d.a)(t,e),Object(c.a)(t,[{key:"user_list",value:function(e){console.log("User List Receivd"),console.log(e);var t=JSON.parse(e.data).users;this.setState({users:t})}},{key:"server_disconnect",value:function(e){console.log("Server Disconnect Receivd"),console.log(e),this.setState({showLogin:!0,showChatRoom:!1,showFailedLogin:!1})}},{key:"user_join",value:function(e){console.log("User Join Received"),console.log(e);var t=JSON.parse(e.data).user;console.log("new user"),console.log(t);var s=this.state.users;s.push(t);var n=Object(l.a)(new Set(s)),o=this.state.messages;o.push(this.format_event(JSON.parse(e.data),"Join")),this.setState({users:n,messages:o})}},{key:"new_message",value:function(e){console.log("New Message Receivd");var t=JSON.parse(e.data);console.log(t);var s=this.state.messages,n=e.lastEventId;console.log("uid of last_event_id"),console.log(n),s.push(this.format_event(t,"Message")),console.log(s),this.setState({messages:s})}},{key:"message_history",value:function(e){console.log("Message Histrory Received"),console.log(e);var t=JSON.parse(e.data).messages;console.log(t);var s=this.state.messages;console.log("local messages"),console.log(s);for(var n=0;n<t.length;n++)s.push(this.format_event(t[n],""));console.log("New local messages:"),console.log(s),this.setState({messages:s})}},{key:"user_part",value:function(e){console.log("User Part Receivd"),console.log(e);var t=JSON.parse(e.data).user;console.log(t);for(var s=this.state.users,n=0;n<s.length;n++)s[n]==t&&s.splice(n,1);JSON.parse(e.data);var o=this.state.messages;o.push(this.format_event(JSON.parse(e.data),"Part")),console.log("new User list"),console.log(s),this.setState({users:s,messages:o})}},{key:"server_status",value:function(e){console.log("Server Status Receivd"),console.log(e);var t=JSON.parse(e.data),s=this.state.messages;s.push(this.format_event(t,"SERVER_STATUS")),this.setState({messages:s})}},{key:"format_event",value:function(e,t){console.log("formatting event: "),console.log(e);var s=function(e){var t=new Date(1e3*e);return t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")}(e.created)+": ";return"Join"==t?s+=" JOIN "+e.user:"Part"==t?s+=" PART "+e.user:"SERVER_STATUS"==t||e.status?s+="(SERVER_STATUS) "+e.status:s+="("+e.user+") "+e.message,s}},{key:"componentWillUnmount",value:function(){null}},{key:"render",value:function(){return console.log("rendering application"),console.log("current value of users is: "+this.state.users),o.a.createElement("div",{className:"App"},o.a.createElement(f,null),this.state.showLogin?o.a.createElement(E,{loginSuccessful:this.loginSuccessful,loginFailed:this.loginFailed}):null,this.state.showFailedLogin?o.a.createElement("p",null,"Login Failed"):null,o.a.createElement("div",{className:"ChatRoom",hidden:!this.state.showChatRoom},o.a.createElement("div",{className:"ChatRoomBody"},o.a.createElement(w,{userList:this.state.users}),o.a.createElement(O,{messageList:this.state.messages})),o.a.createElement(b,null)))}}]),t}(o.a.Component),f=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(m.a)(t).call(this))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("header",null,o.a.createElement("h1",null,"Chat Room"))}}]),t}(o.a.Component),b=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(m.a)(t).call(this))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"submitClicked",value:function(){console.log("Submit button was clicked.");var e=document.getElementById("composeInputBox").value;console.log(e),document.getElementById("composeInputBox").value="";var t=new XMLHttpRequest,s=v+"/message";t.open("POST",s),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.setRequestHeader("Authorization","Bearer "+h),t.onload=function(){console.log("response received from serverr: "),console.log(t.response),201===t.status?console.log("message was posted."):403===t.status?console.log("Signed token is not valid"):422===t.status&&console.log("Message sent was blank.")},t.send("message="+e)}},{key:"render",value:function(){return o.a.createElement("div",{className:"compose"},o.a.createElement("input",{type:"text",id:"composeInputBox",name:"userMessage"}),o.a.createElement("input",{type:"submit",value:"Send Message",onClick:this.submitClicked}))}}]),t}(o.a.Component),E=function(e){function t(e){var s;return Object(i.a)(this,t),(s=Object(u.a)(this,Object(m.a)(t).call(this,e))).validateLogin=function(){console.log("validating login information"),console.log("this.props"),console.log(s.props);var e=document.getElementById("userrr").value,t=document.getElementById("passss").value,n=new XMLHttpRequest,o=v+"/login";n.open("POST",o),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var a=s.props;n.onload=function(){console.log("response received from serverr: "),console.log(n.response),201===n.status?(console.log("login was successful"),h=JSON.parse(n.response).token,a.loginSuccessful(h)):(console.log("Login failed"),a.loginFailed())};var r="username="+e+"&password="+t;console.log(r),n.send(r)},console.log(e),s.props=e,console.log(s.props),s}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"login"},o.a.createElement("form",null,o.a.createElement("label",{for:"username"},"Username:"),o.a.createElement("input",{id:"userrr",type:"text",name:"username"}),o.a.createElement("br",null),o.a.createElement("label",{for:"password"},"Password:"),o.a.createElement("input",{id:"passss",type:"password",name:"password"}),o.a.createElement("br",null),o.a.createElement("button",{type:"button",onClick:this.validateLogin},"Login")))}}]),t}(o.a.Component),O=function(e){function t(e){var s;return Object(i.a)(this,t),(s=Object(u.a)(this,Object(m.a)(t).call(this,e))).scrollToBottom=function(){s.messagesEnd.scrollIntoView({behavior:"smooth"})},s}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e=this;return console.log("rendering messageList"),console.log("Messages are"),console.log(this.props.messageList),o.a.createElement("div",{className:"messageList"},o.a.createElement("h3",{className:"sectionTitle"},"Messages"),o.a.createElement("div",{className:"messages"},this.props.messageList.map((function(e,t){return o.a.createElement("li",{key:t}," ",e," ")}))),o.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}}))}}]),t}(o.a.Component),w=function(e){function t(e){return Object(i.a)(this,t),Object(u.a)(this,Object(m.a)(t).call(this,e))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return console.log("rendering user list."),console.log("Users are"),console.log(this.props.userList),o.a.createElement("div",{className:"userList"},o.a.createElement("h3",{className:"sectionTitle"},"Online"),o.a.createElement("div",{className:"usersOnline"},this.props.userList.map((function(e,t){return o.a.createElement("li",{key:t}," ",e," ")}))))}}]),t}(o.a.Component);var S=p;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(S,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[19,1,2]]]);
//# sourceMappingURL=main.f0441c8e.chunk.js.map